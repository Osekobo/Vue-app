<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <link rel="icon" href="ico.png" type="image/gif" />
  <link rel="stylesheet" href="sty.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiar">
    <div class="container-fluid">
      <a class="navbar-brand text-warning fw-bold" href="#">Auto Dealers</a>
      <button class="btn btn-outline-secondary d-lg-none" id="sidebarToggle">
        â˜°
      </button>
    </div>
  </nav>
  <nav class="navbar  flex-column p-3 sidebar" id="sidebar">
    <a class="navbar-brand mb-4" href="index.html">Home</a>
    <ul class="navbar-nav flex-column w-100 main-links">
      <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
      <li class="nav-item"><a class="nav-link" href="purchases.html">Purchases</a></li>
      <li class="nav-item"><a class="nav-link" href="sales.html">Sales</a></li>
    </ul>
    <ul class="navbar-nav flex-column w-100 logout-link">
      <li class="nav-item mt-auto"><a class=""> <button id="logoutBtn" class="btn btn-outline-danger" type="submit"
            @click="logout">Logout</button></a></li>
    </ul>
  </nav>
  <main>
    <h1 class="text-white text-center">Dashboard</h1>
    <div id="app" class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
      <div class="row w-100">
        <div class="col-md-6 col-sm-12 mx-auto mt-4">
          <canvas id="bar-chart" width="800" height="450"></canvas>
        </div>
      </div>
    </div>
  </main>
  <footer>
    <p class="mb-0">&copy; 2025 The Mall</p>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.16/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.8/axios.min.js"></script>
  <script>
    new Vue({
      el: "#app",
      data: {
        data: [],
        labels: [],
      },
      methods: {
        async remainingstock() {
          const headers = {
            headers: { Authorization: `Bearer ${localStorage.getItem("token")}` }
          };
          axios.get("http://127.0.0.1:5000/api/dashboard", headers)
            .then((response) => {
              this.data = response.data.data;
              this.labels = response.data.labels;
              console.log(this.data);
              console.log(this.labels);
              // Bar chart
              new Chart(document.getElementById("bar-chart"), {
                type: 'bar',
                data: {
                  labels: this.labels,
                  datasets: [
                    {
                      label: "Remaining Stock",
                      backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                      data: this.data
                    }
                  ]
                },
                options: {
                  responsive: true,
                  plugins: {
                    legend: {
                      display: false,
                      labels: {
                        color: "#ffffff"
                      }
                    },
                    title: {
                      display: true,
                      text: 'Remaining Stock Per Car',
                      color: "#ffffff",
                      font: {
                        size: 18
                      }
                    }
                  },
                  scales: {
                    x: {
                      ticks: {
                        color: "#ffffff"
                      },
                      grid: {
                        color: "rgba(255, 255, 255, 0.2)"
                      }
                    },
                    y: {
                      ticks: {
                        color: "#ffffff"
                      },
                      grid: {
                        color: "rgba(255, 255, 255, 0.2)"
                      }
                    }
                  }
                }
              });
            })
            .catch((error) => {
              console.error("There was an error!", error);
              alert("Failed to fetch dashboard data!");
            });
        },
      },
      logout() {
        localStorage.removeItem("token");
        window.location.href = "login.html"
      },
      mounted() {
        if (localStorage.getItem("token") != null) {
          this.remainingstock();
        } else {
          window.location.href = "login.html";
        }
      },
    });
  </script>
  <script>
    const logoutBtn = document.getElementById('logoutBtn');
    const sidebar = document.getElementById('sidebar');
    const toggleBtn = document.getElementById('sidebarToggle');
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('show');
    });
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem("token");
      window.location.href = "login.html";
    });
    window.addEventListener('scroll', function () {
      const scrollTop = window.pageYOffset;
      document.body.style.backgroundPosition = `center ${scrollTop * 0.5}px`;
    });
  </script>
</body>

</html>