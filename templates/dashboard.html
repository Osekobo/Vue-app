<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <!-- <link rel="icon" href="/static/favicon.gif" type="image/gif" /> -->
</head>

<body>
  <header class="flex-fill">
    <nav class="navbar navbar-expand-lg bg-body-secondary">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">The Mall</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>
            <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
            <li class="nav-item"><a class="nav-link" href="purchases.html">Purchases</a></li>
            <li class="nav-item"><a class="nav-link" href="sales.html">Sales</a></li>
          </ul>
          <form class="d-flex" role="search">
            <button class="btn btn-outline-danger" type="submit" href="login.html">Logout</button>
          </form>
        </div>
      </div>
    </nav>
  </header>

  <div id="app" class="container">
    <div class="row">
      <div class="col-md-6 col-sm-12 mt-4">
        <canvas id="bar-chart" width="800" height="450"></canvas>
      </div>
    </div>
  </div>
  
  <footer class="text-center bg-dark text-white p-3 mt-auto">
    <p class="mb-0">&copy; 2025 The Mall</p>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.7.16/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.8/axios.min.js"></script>

  <script>
    new Vue({
      el: "#app",
      data: {
        data: [],
        labels: [],
      },
      methods: {
        async remainingstock() {
          const headers = {
            headers: { Authorization: `Bearer ${localStorage.getItem("token")}` }
          };
          axios.get("http://127.0.0.1:5000/api/dashboard", headers)
            .then((response) => {
              this.data = response.data.data;
              this.labels = response.data.labels;
              console.log(this.data);
              console.log(this.labels);
              // Bar chart
              new Chart(document.getElementById("bar-chart"), {
                type: 'bar',
                data: {
                  labels: this.labels,
                  datasets: [
                    {
                      label: "Remaining Stock",
                      backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9", "#c45850"],
                      data: this.data
                    }
                  ]
                },
                options: {
                  legend: { display: false },
                  title: {
                    display: true,
                    text: 'Predicted world population (millions) in 2050'
                  }
                }
              });
            })
            .catch((error) => {
              console.error("There was an error!", error);
              alert("Failed to fetch dashboard data!");
            });
        },
      },
      mounted() {
        if (localStorage.getItem("token") != null) {
          this.remainingstock();
        } else {
          window.location.href = "login.html";
        }
      },
    });
  </script>
</body>

</html>